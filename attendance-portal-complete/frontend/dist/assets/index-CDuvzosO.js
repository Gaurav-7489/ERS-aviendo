import{j as e,C as y,a as v,r as c,u as g,w as S,L as p,R as C,b as u,N as E,c as k,d as L,B as P}from"./vendor-ChrPHCdi.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const t of o.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&n(t)}).observe(document,{childList:!0,subtree:!0});function a(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=a(s);fetch(s.href,o)}})();function R(){return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-sky-900 mb-6",children:"Blue Attendance Portal"}),e.jsx("div",{className:"w-full max-w-4xl p-6",children:e.jsx("div",{style:{height:420},className:"rounded-2xl shadow-lg overflow-hidden bg-white",children:e.jsxs(y,{children:[e.jsx("ambientLight",{intensity:.7}),e.jsx("directionalLight",{position:[5,5,5]}),e.jsxs("mesh",{rotation:[.6,.2,.1],children:[e.jsx("torusKnotBufferGeometry",{args:[1.5,.4,128,16]}),e.jsx("meshStandardMaterial",{metalness:.9,roughness:.2})]})]})})})]})}const d=v.create({baseURL:"http://localhost:5000/api"});d.interceptors.request.use(r=>{const l=localStorage.getItem("token");return l&&(r.headers.Authorization="Bearer "+l),r});function D(){const[r,l]=c.useState("signin"),[a,n]=c.useState(""),[s,o]=c.useState(""),[t,m]=c.useState("student"),j=async()=>{var i,f;try{if(r==="signup"){const h=await d.post("/auth/signup",{email:a,password:s,role:t});localStorage.setItem("token",h.data.token),alert("Signed up")}else{const h=await d.post("/auth/signin",{email:a,password:s,role:t});localStorage.setItem("token",h.data.token),localStorage.setItem("role",h.data.role),alert("Signed in")}}catch(h){alert(((f=(i=h.response)==null?void 0:i.data)==null?void 0:f.msg)||"err")}};return e.jsxs("div",{className:"p-6 max-w-md mx-auto bg-white rounded-xl shadow",children:[e.jsx("h2",{className:"text-2xl mb-4",children:r==="signup"?"Student Signup":"Signin"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{onClick:()=>l("signin"),className:"px-3 py-1 rounded bg-blue-100",children:"Signin"}),e.jsx("button",{onClick:()=>l("signup"),className:"px-3 py-1 rounded bg-blue-100",children:"Signup (student)"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{placeholder:"Email",value:a,onChange:i=>n(i.target.value),className:"p-2 border"}),e.jsx("input",{type:"password",placeholder:"Password",value:s,onChange:i=>o(i.target.value),className:"p-2 border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{children:"Role"}),e.jsxs("select",{value:t,onChange:i=>m(i.target.value),className:"p-2 border",children:[e.jsx("option",{value:"student",children:"Student"}),e.jsx("option",{value:"teacher",children:"Teacher (signin only)"})]})]}),e.jsx("button",{onClick:j,className:"mt-3 bg-sky-700 text-white px-4 py-2 rounded",children:"Submit"})]})]})}function A(){const[r,l]=c.useState({name:"",department:"",course:"",year:"",semester:"",roll:""});c.useEffect(()=>{(async()=>{try{const n=await d.get("/users/me");n.data.profile&&l(n.data.profile)}catch{}})()},[]);const a=async()=>{await d.patch("/users/me",r),alert("Saved")};return e.jsxs("div",{className:"p-6 max-w-lg mx-auto bg-white rounded shadow",children:[e.jsx("h2",{className:"text-xl mb-3",children:"Profile (fill once)"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[["name","department","course","year","semester","roll"].map(n=>e.jsx("input",{placeholder:n,value:r[n]||"",onChange:s=>l({...r,[n]:s.target.value}),className:"p-2 border"},n)),e.jsx("button",{onClick:a,className:"mt-3 bg-sky-700 text-white px-4 py-2 rounded",children:"Save Profile"})]})]})}function M(){const[r,l]=c.useState([]);return c.useEffect(()=>{(async()=>{try{const a=await d.get("/notes");l(a.data)}catch{}})()},[]),e.jsxs("div",{className:"p-6 max-w-4xl mx-auto bg-white rounded shadow",children:[e.jsx("h2",{className:"text-2xl mb-4",children:"Classroom"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Bulletin / Notes"}),r.length===0?e.jsx("p",{children:"No notes"}):r.map(a=>{var n,s,o;return e.jsxs("div",{className:"p-3 border rounded my-2",children:[e.jsx("strong",{children:a.title}),e.jsx("p",{children:a.content}),e.jsxs("small",{children:["By: ",((s=(n=a.author)==null?void 0:n.profile)==null?void 0:s.name)||((o=a.author)==null?void 0:o.email)]})]},a._id)})]}),e.jsx("div",{children:e.jsx("p",{children:"Student actions like mark attendance (if allowed) or view dashboard are here."})})]})}function _(){const[r,l]=c.useState([]),[a,n]=c.useState(new Date().toISOString().slice(0,10));c.useEffect(()=>{(async()=>{try{const t=await d.get("/users/class/all");l(t.data)}catch(t){console.error(t)}})()},[]);const s=async()=>{try{const t=await d.get(`/attendance/class/${a}`);console.log(t.data),alert("Fetched attendance; check console for records")}catch(t){console.error(t)}},o=async()=>{const t=prompt("From (YYYY-MM-DD)",a),m=prompt("To (YYYY-MM-DD)",a);if(!t||!m)return;const i=(await d.get(`/attendance/export?from=${t}&to=${m}`)).data.map(x=>{var b,N,w;return{date:new Date(x.date).toLocaleDateString(),name:((b=x.student.profile)==null?void 0:b.name)||x.student.email,roll:((N=x.student.profile)==null?void 0:N.roll)||"",department:((w=x.student.profile)==null?void 0:w.department)||"",status:x.status}}),f=g.json_to_sheet(i),h=g.book_new();g.book_append_sheet(h,f,"Attendance"),S(h,`attendance_${t}_to_${m}.xlsx`)};return e.jsxs("div",{className:"p-6 max-w-5xl mx-auto bg-white rounded shadow",children:[e.jsx("h2",{className:"text-2xl mb-4",children:"Teacher — Class Roster"}),e.jsxs("div",{className:"mb-3 flex gap-2 items-center",children:[e.jsx("input",{type:"date",value:a,onChange:t=>n(t.target.value),className:"p-2 border"}),e.jsx("button",{onClick:s,className:"px-3 py-1 bg-sky-600 text-white rounded",children:"Fetch Attendance"}),e.jsx("button",{onClick:o,className:"px-3 py-1 bg-indigo-600 text-white rounded",children:"Export Excel"})]}),e.jsxs("table",{className:"w-full table-auto border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2",children:"Name"}),e.jsx("th",{className:"border p-2",children:"Email"}),e.jsx("th",{className:"border p-2",children:"Roll"})]})}),e.jsx("tbody",{children:r.map(t=>{var m,j;return e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2",children:((m=t.profile)==null?void 0:m.name)||"—"}),e.jsx("td",{className:"border p-2",children:t.email}),e.jsx("td",{className:"border p-2",children:((j=t.profile)==null?void 0:j.roll)||"—"})]},t._id)})})]})]})}function B(){var a,n,s,o;const[r,l]=c.useState(null);return c.useEffect(()=>{(async()=>{try{const t=await d.get("/users/me");l(t.data)}catch(t){console.error(t)}})()},[]),r?e.jsxs("div",{className:"p-6 max-w-3xl mx-auto bg-white rounded shadow",children:[e.jsx("h2",{className:"text-2xl mb-3",children:"My Dashboard"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",((a=r.profile)==null?void 0:a.name)||r.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Department:"})," ",((n=r.profile)==null?void 0:n.department)||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"CGPA:"})," ",((s=r.profile)==null?void 0:s.cgpa)||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Last Exam:"})," ",((o=r.profile)==null?void 0:o.lastExamScore)||"—"]})]}):e.jsx("div",{className:"p-6",children:"Login and fill profile to see dashboard"})}function Y(){return e.jsxs("div",{children:[e.jsxs("nav",{className:"p-4 flex gap-4",children:[e.jsx(p,{to:"/",children:"Welcome"}),e.jsx(p,{to:"/auth",children:"Auth"}),e.jsx(p,{to:"/profile",children:"Profile"}),e.jsx(p,{to:"/classroom",children:"Classroom"}),e.jsx(p,{to:"/teacher",children:"Teacher"}),e.jsx(p,{to:"/dashboard",children:"Dashboard"})]}),e.jsxs(C,{children:[e.jsx(u,{path:"/",element:e.jsx(R,{})}),e.jsx(u,{path:"/auth",element:e.jsx(D,{})}),e.jsx(u,{path:"/profile",element:e.jsx(A,{})}),e.jsx(u,{path:"/classroom",element:e.jsx(M,{})}),e.jsx(u,{path:"/teacher",element:e.jsx(_,{})}),e.jsx(u,{path:"/dashboard",element:e.jsx(B,{})}),e.jsx(u,{path:"*",element:e.jsx(E,{to:"/"})})]})]})}k(document.getElementById("root")).render(e.jsx(L.StrictMode,{children:e.jsx(P,{children:e.jsx(Y,{})})}));
